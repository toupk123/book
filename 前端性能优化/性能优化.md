# 性能优化清单

https://juejin.im/post/6844903765682683911，基本都是从这里面看到的内容

性能优化不光是load和domContentloaded 时间,要优先关注用户可以感知到的页面。

## 度量标准

1. **首次有效的渲染时间**-FMP，主要内容出现在页面上的时间。
2. **交互时间**-TTI，是指页面布局已经稳定，关键页面字体已经可见，主进程可以处理用户的一些交互所需要的时间。用来了解用户在没有延迟的情况下打开网站需要多长的时间。
3. **输入响应**FID 接口响应用户在实现交互操作所需的时间。
4. **速度指数** -- Speed Index 测量页面内容在视觉上的填充速度，得分越低越好。速度指数得分是根据视觉进度的速度计算的，它只是一个计算值，对于视觉窗口大小很敏感，所以您需要定义一个与大众相匹配的测试标准 // 暂时不知道这个是干嘛的
5. **CPU时间花费** 指的是 CPU 时间一个度量，指示主线程处理有效负载的繁忙程度。它显示了主线程被阻止的频率和持续时间，用于绘制，渲染，编写脚本和加载。根据 janky 的经验，高 CPU 时间即表示用户遇到他们的行动和反应之间存在明显的滞后。使用 WebPageTest，您可以 [在 Chrome 选项卡上选择 Capture Dev Tools Timeline](https://deanhume.com/ten-things-you-didnt-know-about-webpagetest-org/)，以显示主线程使用 WebPageTest 在任何设备上运行时的详细分数。
6. **[广告权重影响](https://calendar.perfplanet.com/2017/measuring-adweight/)** 如果您的网站主要收入来源于广告，那么与广告业务模块的代码就要特别关注。Paddy Ganti 的 [脚本](https://calendar.perfplanet.com/2017/measuring-adweight/) 构造了两个URL（一个是正常的 URL，一个阻止广告的 URL），提示通过 WebPageTest 生成视频比较并报告增量。
7. 关键路径，从浏览器收到html css和js字节到其进行必需的处理，并不包括图片。
8. **完全加载时间**，DOMContentLoaded,onload事件
9. **白屏时间(FP)**，当页面开始渲染页面，白屏触发。
10. **首屏时间(FCP)**，当页面开始绘制第一个dom内容,

## 计算FP，FCP和FMP



## 性能优化手段

性能优化一个重要原则：永远呈现必要的内容。

### 结构层

AMP HTML提供更好的移动端的用户体验。尽量用一些轻量的html结构。

1. 比如对图片元素，可以封装成一个组件，等主题内容渲染完毕后，异步加载图片，对音频也可以这样做。
2. 减少html结构的嵌套，如果可以用伪元素就可以用伪元素。

### 表现层

1. 尽量使用transfrom等css3属性，开启硬件加速
2. 避免在html中书写style
3. 尽量使用css3的动画
4. 使用requestAnimationFrame
5. 减少重拍
6. 动画过多，就可以使用canvas

### 行为层

1. 对于数据量比较大的计算，可以使用纯函数，对这些运算进行缓存。
2. 多线程计算，使用webworker
3. 对一些数据结构优化
4. 注意尾递归优化
5. 使用async 和defer异步加载js

### 图片优化

1. 压缩图片体积
2. 存放到第三方图片存储，并且通过他们提供的api，加载适合的图片。
3. 如果兼容性合适的话，使用webp格式的图片
4. 图片懒加载
5. 对一些小的图片，应该由webpack转换成base64，减少请求。
6. 能用icon的时候，尽量不要用图片

### http方面

1. 减少http请求，尽量减少页面的请求数（尽量减少首屏加载时间）。
2. 缓存资源，尽量使用强缓存。
3. 压缩代码，并且开始gzip
4. 脚本放在尾部，并且使用异步方式加载。
5. 尽量对首屏进行优化（同构优化，ssr）
6. 按需加载，异步加载组件，图片懒加载，滚屏加载
7. 减少cookie
8. 避免重定向
9. 预加载，并且在加载完成之后，再跳转到下一个页面

### webpack

1. 剔除不需要使用的代码



### 其他

1. 使用骨架屏，进行loading加载。



## 配合ssr的同构



### 一些资源

https://github.com/ElemeFE/page-skeleton-webpack-plugin/blob/master/docs/i18n/zh_cn.md 骨架屏